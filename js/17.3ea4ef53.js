(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[17],{"2e78":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"flex flex-start ",attrs:{id:"backDonate"}},[a("q-page-container",{staticClass:"container-back100 q-my-none"},[a("q-btn",{staticClass:"add",attrs:{round:"",icon:"fa fa-plus",size:"md"},on:{click:function(t){e.donateCard=!0}}}),a("q-item",{attrs:{id:"title"}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"favorite"}})],1),a("q-item-section",[e._v("物資捐贈管理")])],1),a("q-table",{attrs:{filter:e.filter,columns:e.titles,data:this.images,"row-key":"name","rows-per-page-options":[5,8,10],grid:e.$q.screen.xs},scopedSlots:e._u([{key:"body",fn:function(t){return[a("q-tr",[a("q-td",{key:"item"},[t.row.edit?a("q-input",{attrs:{outlined:"",filled:""},model:{value:t.row.modelItem,callback:function(a){e.$set(t.row,"modelItem",a)},expression:"image.row.modelItem"}}):a("q-item-label",{attrs:{lines:1}},[e._v("\n              "+e._s(t.row.item)+"\n            ")])],1),a("q-td",{key:"requester"},[t.row.edit?a("q-input",{attrs:{outlined:"",filled:""},model:{value:t.row.modelRequester,callback:function(a){e.$set(t.row,"modelRequester",a)},expression:"image.row.modelRequester"}}):a("q-item-label",{attrs:{lines:2}},[e._v("\n              "+e._s(t.row.requester)+"\n            ")])],1),a("q-td",{key:"category"},[a("div",{staticClass:"text-pre-wrap"}),t.row.edit?a("q-input",{attrs:{outlined:"",filled:""},model:{value:t.row.modelCategory,callback:function(a){e.$set(t.row,"modelCategory",a)},expression:"image.row.modelCategory"}}):a("q-item-label",{attrs:{lines:1}},[e._v("\n              "+e._s(t.row.category)+"\n            ")])],1),a("q-td",{key:"spec"},[a("div",{staticClass:"text-pre-wrap"}),t.row.edit?a("q-input",{attrs:{outlined:"",filled:""},model:{value:t.row.modelSpec,callback:function(a){e.$set(t.row,"modelSpec",a)},expression:"image.row.modelSpec"}}):a("q-item-label",{attrs:{lines:1}},[e._v("\n              "+e._s(t.row.spec)+"\n            ")])],1),a("q-td",{key:"description"},[a("div",{staticClass:"text-pre-wrap"}),t.row.edit?a("q-input",{attrs:{outlined:"",filled:"","stack-label":"","bottom-slots":"",type:"textarea",rules:[function(e){return e.length<=50||"最多輸入50個字"}]},model:{value:t.row.modelDescription,callback:function(a){e.$set(t.row,"modelDescription",a)},expression:"image.row.modelDescription"}}):a("q-item-label",{attrs:{lines:2}},[e._v("\n              "+e._s(t.row.title)+"\n            ")])],1),a("q-td",{key:"amount"},[t.row.edit?a("q-input",{attrs:{outlined:"",filled:""},model:{value:t.row.modelAmount,callback:function(a){e.$set(t.row,"modelAmount",a)},expression:"image.row.modelAmount"}}):a("q-item-label",{attrs:{lines:1}},[e._v("\n              "+e._s(t.row.amount)+"\n            ")])],1),a("q-td",{key:"active"},[t.row.edit?e._e():a("q-btn",{staticClass:"edit",attrs:{outline:"",rounded:""},on:{click:function(a){return e.edit(t)}}},[a("i",{staticClass:"fas fa-pen"})]),t.row.edit?e._e():a("q-btn",{staticClass:"del",attrs:{outline:"",rounded:""},on:{click:function(a){return e.del(t)}}},[a("i",{staticClass:"fas fa-trash-alt"})]),t.row.edit?a("q-btn",{staticClass:"save",attrs:{outline:"",rounded:""},on:{click:function(a){return e.save(t)}}},[a("i",{staticClass:"fas fa-save"})]):e._e(),t.row.edit?a("q-btn",{staticClass:"cancel",attrs:{outline:"",rounded:""},on:{click:function(a){return e.cancel(t)}}},[a("i",{staticClass:"fas fa-times"})]):e._e()],1)],1)]}},{key:"top-right",fn:function(){return[a("q-input",{attrs:{filled:"",dense:"",outlined:"",placeholder:"請輸入關鍵字"},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}})]},proxy:!0}])}),a("q-dialog",{model:{value:e.donateCard,callback:function(t){e.donateCard=t},expression:"donateCard"}},[a("q-card",{attrs:{id:"donateCard"}},[a("q-card-section",[a("div",{attrs:{"text-overline":""}},[e._v("新增物資需求")])]),a("form",{on:{submit:function(t){return t.preventDefault(),e.add(t)},reset:e.addReset}},[a("q-card-section",{staticClass:"row"},[a("div",{staticClass:"mt-0 col-12 q-gutter-y-md"},[a("q-input",{attrs:{rounded:"",outlined:"",required:"",auto:"",type:"text",label:"物品名稱 *"},model:{value:e.donate.item,callback:function(t){e.$set(e.donate,"item",t)},expression:"donate.item"}})],1),a("div",{staticClass:"col-12 col-sm-6 q-gutter-y-md"},[a("q-input",{attrs:{rounded:"",outlined:"",required:"",type:"text",label:"需求者 *"},model:{value:e.donate.requester,callback:function(t){e.$set(e.donate,"requester",t)},expression:"donate.requester"}})],1),a("div",{staticClass:"col-12 col-sm-6 q-gutter-y-md"},[a("q-input",{attrs:{rounded:"",outlined:"",required:"",type:"text",label:"規格 *"},model:{value:e.donate.spec,callback:function(t){e.$set(e.donate,"spec",t)},expression:"donate.spec"}})],1),a("div",{staticClass:"col-12 col-sm-6 q-gutter-y-md"},[a("q-select",{attrs:{rounded:"",outlined:"",required:"",label:"類別 *",options:e.options},model:{value:e.donate.category,callback:function(t){e.$set(e.donate,"category",t)},expression:"donate.category"}})],1),a("div",{staticClass:"col-12 col-sm-6 q-gutter-y-md"},[a("q-input",{attrs:{rounded:"",outlined:"",required:"",type:"text",label:"數量 *"},model:{value:e.donate.amount,callback:function(t){e.$set(e.donate,"amount",t)},expression:"donate.amount"}})],1),a("div",{staticClass:"col-12 col-sm-6 q-gutter-y-md"},[a("q-input",{attrs:{rounded:"",outlined:"",required:"",label:"圖片說明","bottom-slots":"",counter:"",type:"textarea",rules:[function(e){return!!e||"請輸入1-50個字"},function(e){return e.length<=50||"最多輸入50個字"}]},scopedSlots:e._u([{key:"hint",fn:function(){return[e._v("\n                  請輸入1-50個字\n                ")]},proxy:!0}]),model:{value:e.donate.description,callback:function(t){e.$set(e.donate,"description",t)},expression:"donate.description"}})],1),a("div",{staticClass:"col-12 col-sm-6 q-gutter-y-md"},[a("img-inputer",{attrs:{icon:"img","bottom-text":"點擊或拖曳更換圖片",placeholder:"請選擇上傳圖片","max-size":1024,"bottom-slots":"",exceedSizeText:"檔案大小不能超過",accept:"image/*"},model:{value:e.donate.addImg,callback:function(t){e.$set(e.donate,"addImg",t)},expression:"donate.addImg"}})],1),a("div",{staticClass:"mt-0 col-md-6 q-gutter-y-md "}),a("q-card-actions",{staticClass:"col-12",attrs:{align:"center"}},[a("q-btn",{attrs:{rounded:"",outline:"",label:"送出",type:"submit"}}),a("q-btn",{attrs:{rounded:"",outline:"",width:"100px",label:"重設",type:"reset"}})],1)],1)],1)],1)],1)],1)],1)},s=[],r=(a("e01a"),a("26e9"),a("a434"),{name:"PageDonate",data(){return{donateCard:!1,filter:"",donate:{addImg:null,item:"",requester:"",spec:"",category:"",description:"",amount:""},images:[],titles:[{name:"item",required:!0,label:"物資名稱",align:"left",field:"item",sortable:!0},{name:"requester",required:!0,align:"left",label:"需求單位",field:"requester"},{name:"category",required:!0,align:"left",label:"類別",field:"category",sortable:!0},{name:"spec",required:!0,align:"left",label:"規格",field:"spec"},{name:"description",required:!0,align:"left",label:"需求說明",field:"title"},{name:"amount",required:!0,align:"left",label:"需求數量",field:"amount",sortable:!0},{name:"active",required:!0,align:"left",label:""}],options:["文具","書籍","玩具","電器","醫療","其他"]}},computed:{member(){return this.$store.state.member}},methods:{add(){if(this.donate.addImg.size>1048576)this.$q.notify({color:"red-6",icon:"fas fa-exclamation-circle",message:"圖片太大"});else if(this.donate.addImg.type.includes("image")){const e=new FormData;e.append("member",this.donate.member),e.append("item",this.donate.item),e.append("requester",this.donate.requester),e.append("spec",this.donate.spec),e.append("category",this.donate.category),e.append("amount",this.donate.amount),e.append("description",this.donate.description),e.append("image",this.donate.addImg),this.axios.post("https://mumuweb.herokuapp.com/donates/",e).then((e=>{e.data.success?(e.data.result.src="https://mumuweb.herokuapp.com/donates/file/"+e.data.result.file,e.data.result.edit=!1,e.data.result.modelItem=e.data.result.item,e.data.result.modelRequester=e.data.result.requester,e.data.result.modelSpec=e.data.result.spec,e.data.result.modelCategory=e.data.result.category,e.data.result.modelDescription=e.data.result.description,e.data.result.title=e.data.result.description,e.data.result.modelAmount=e.data.result.amount,delete e.data.result.file,delete e.data.result.description,this.images.unshift(e.data.result),this.donate.addImg=null,this.donate.item="",this.donate.requester="",this.donate.spec="",this.donate.category="",this.donate.description="",this.donate.amount="",this.donateCard=!1,this.$q.notify({color:"light-green",icon:"fas fa-check-circle",message:"新增成功"})):this.$q.notify({color:"red-6",icon:"fas fa-exclamation-circle",message:e.data.message})})).catch((e=>{this.$q.notify({color:"red-6",icon:"fas fa-exclamation-circle",message:e.response.data.message})}))}else this.$q.notify({color:"red-6",icon:"fas fa-exclamation-circle",message:"檔案格式錯誤"})},addReset(){this.donate.addImg=null,this.donate.item="",this.donate.requester="",this.donate.spec="",this.donate.category="",this.donate.description="",this.donate.amount=""},edit(e){e.row.edit=!0,e.modelItem=e.row.item,e.modelRequester=e.row.requester,e.modelSpec=e.row.spec,e.modelCategory=e.row.category,e.modelDescription=e.row.title,e.modelAmount=e.row.amount},del(e){this.axios.delete("https://mumuweb.herokuapp.com/donates/"+e.row._id).then((t=>{t.data.success?(this.images.splice(e.rowIndex,1),this.$q.notify({color:"light-green",icon:"fas fa-check-circle",message:"刪除成功"})):this.$q.notify({color:"red-6",icon:"fas fa-exclamation-circle",message:t.data.message})})).catch((e=>{this.$q.notify({color:"red-6",icon:"fas fa-exclamation-circle",message:e.response.data.message})}))},save(e){this.axios.patch("https://mumuweb.herokuapp.com/donates/"+e.row._id,{item:e.row.modelItem,requester:e.row.modelRequester,spec:e.row.modelSpec,category:e.row.modelCategory,description:e.row.modelDescription,amount:e.row.modelAmount}).then((t=>{t.data.success?(console.log(e),e.row.edit=!1,e.row.item=e.row.modelItem,e.row.requester=e.row.modelRequester,e.row.spec=e.row.modelSpec,e.row.category=e.row.modelCategory,e.row.title=e.row.modelDescription,e.row.amount=e.row.modelAmount,this.$q.notify({color:"light-green",icon:"fas fa-check-circle",message:"保存成功"})):this.$q.notify({color:"red-6",icon:"fas fa-exclamation-circle",message:t.data.message})})).catch((e=>{this.$q.notify({color:"red-6",icon:"fas fa-exclamation-circle",message:e.response.data.message})}))},cancel(e){e.row.edit=!1,e.row.modelItem=e.row.item,e.row.modelRequester=e.row.requester,e.row.modelSpec=e.row.spec,e.row.modelCategory=e.row.category,e.row.modelDescription=e.row.title,e.row.modelAmount=e.row.amount}},mounted(){this.axios.get("https://mumuweb.herokuapp.com/donates/").then((e=>{e.data.success?this.images=e.data.result.map((e=>(e.src="https://mumuweb.herokuapp.com/donates/file/"+e.file,e.edit=!1,e.modelItem=e.item,e.modelRequester=e.requester,e.modelCategory=e.category,e.modelSpec=e.spec,e.title=e.description,e.modelDescription=e.description,e.modelAmount=e.amount,delete e.file,delete e.description,e))).reverse():this.$q.notify({color:"red-6",icon:"fas fa-exclamation-circle",message:e.data.message})})).catch((e=>{this.$q.notify({color:"red-6",icon:"fas fa-exclamation-circle",message:e.response.data.message})}))}}),i=r,n=a("2877"),l=a("9989"),d=a("09e3"),c=a("9c40"),m=a("66e5"),u=a("4074"),p=a("0016"),f=a("eaac"),q=a("bd08"),g=a("db86"),w=a("27f9"),h=a("0170"),b=a("24e8"),y=a("f09f"),x=a("a370"),v=a("ddd8"),k=a("4b7e"),C=a("eebe"),$=a.n(C),_=Object(n["a"])(i,o,s,!1,null,null,null);t["default"]=_.exports;$()(_,"components",{QPage:l["a"],QPageContainer:d["a"],QBtn:c["a"],QItem:m["a"],QItemSection:u["a"],QIcon:p["a"],QTable:f["a"],QTr:q["a"],QTd:g["a"],QInput:w["a"],QItemLabel:h["a"],QDialog:b["a"],QCard:y["a"],QCardSection:x["a"],QSelect:v["a"],QCardActions:k["a"]})}}]);